function add_credit(){$("html body").append('<div id="credit"><a href="http://cargotheme.tumblr.com">Cargo Theme</a> by <a href="http://jarredbishop.tumblr.com">Jarred Bishop</a>. Inspired by <a href="http://cargocollective.com">Cargo</a></div>')}function format_notes(){$(".avatar").each(function(){$(this).parent().remove()})}function can_check_for_more_now(){$(".post_preloader").remove();current_page++;is_loading_next=false}function check_for_more(){if(view=="list"){var a=window.pageYOffset;var b=$(document).height();var c=$(window).height();if(a/(b-c)>=.8&&!is_loading_next&&next_page!="no"){is_loading_next=true;$("html body").append('<div id="temp" class="hide"></div>');$(".list").append('<div id="next_'+current_page+'"><div class="post_preloader">loading next page...</div></div>');$("#temp").load(next_page,{},function(a){$(".post_preloader").remove();var b=$(a).children("#main_column .list").html();$("#next_"+current_page).html(b);var c=$(a).children("#info .next_page").text();if(c!=""){next_page=c}else{next_page="no"}setTimeout(can_check_for_more_now,2e3)})}}}function getPhotosetImages(){$(".post_thumb .photoset").each(function(){var a=$(this).parent().attr("id").replace("thumb_","");$.getJSON("/api/read/json?id="+a+"&callback=?",{},function(b){var c=b["posts"][0]["photos"];for(var d=0;d<c.length;d++){var e=c[d]["photo-url-250"];$("#thumb_"+a+" .photoset .thumbs").append('<div class="thumb rounded" style="background-image:url(\''+e+"')\"></div>")}})})}function getVideoThumbs(){$(".list .video").each(function(){var a;var b;var c;var d;var e;var f;var g;var h;var i=$(this).parent().parent().attr("id");a=$(this).html();if(a.indexOf("tumblr.com/swf/")>=0){$("#post_"+i).addClass("tumblr-video");var j=/poster=(http.+?_frame1.jpg)/g;var k=decodeURIComponent(String(j.exec(a)[1]));$("#thumb_"+i+" .video").prepend('<div class="bg rounded" style="background-image:url(\''+k+"');\"></div>")}else{if(a.indexOf("iframe")>=0){if(a.indexOf("vimeo")>=0){var l=/\/video\/[0-9]*"/g;b=String(l.exec(a)).replace("/video/","").replace('"',"");$.getJSON("http://vimeo.com/api/clip/"+b+".json?callback=?",function(a){var b=a[0].thumbnail_large;$("#thumb_"+i+" .video").prepend('<div class="bg rounded" style="background-image:url(\''+b+"');\"></div>")})}}else{var f="";var m=$(this).parent().parent().attr("id");$(this).children("object").children("param").each(function(){if($(this).attr("name")=="movie"){f=$(this).attr("value")}});if(f.indexOf("youtube.com")>=0){f=f.replace("http://www.youtube.com");f=f.replace("http://youtube.com");var n=f.substring(f.indexOf("/v/")+3,f.indexOf("&"));var e="http://i.ytimg.com/vi/"+n+"/0.jpg";$("#thumb_"+m+" .video").prepend('<div class="bg rounded" style="background-image:url(\''+e+"');\"></div>")}else if(f.indexOf("vimeo.com")>=0){f=f.replace("http://vimeo.com/moogaloop.swf?");f=f.replace("http://www.vimeo.com/moogaloop.swf?");var o=f.substring(f.indexOf("clip_id=")+8,f.indexOf("&"));$.getJSON("http://vimeo.com/api/clip/"+o+".json?callback=?",function(a){var b=a[0].thumbnail_large;$("#thumb_"+m+" .video").prepend('<div class="bg rounded" style="background-image:url(\''+b+"');\"></div>")})}}}})}function show_grid(){$.cookie("view",null);$.cookie("view","grid");setTimeout("window.location.reload()",10);return false}function show_list(){$.cookie("view",null);$.cookie("view","list");SWFAddress.setValue("");setTimeout("window.location.reload()",10);return false}function goto_post(a){if(view=="list"){show_grid()}$("#thumb_"+a+" .loading").fadeTo(0,0);$("#thumb_"+a+" .loading").removeClass("hide");$("#thumb_"+a+" .loading").fadeTo(n_speed,1);$("html body").animate({scrollTop:0},n_speed);var b="/post/"+a+"/";if($("#entry").hasClass("hide")){$("#entry").removeClass("hide")}if($(".line").hasClass("hide")){$(".line").removeClass("hide")}$("#entry").html($("#"+a).html());$("#entry").fadeTo(0,0);if($("#entry").hasClass("hide")){$("#entry").removeClass("hide")}$("#entry").fadeTo(200,1);$(".post_thumb").each(function(){if($(this).attr("id")=="thumb_"+a){if(!$(this).hasClass("selected")){$(this).addClass("selected")}}else{if($(this).hasClass("selected")){$(this).removeClass("selected")}}});return false}function history(a){var b=SWFAddress.getValue()+"";if(b=="/"){}else if(b=="about"){if(view=="list"){show_grid()}else{$(".line").removeClass("hide");$("#entry").removeClass("hide");$("#entry").html(""+$("#about").html())}}else if(b=="following"){if(view=="list"){show_grid()}else{$(".line").removeClass("hide");$("#entry").removeClass("hide");$("#entry").html(""+$("#following").html())}}else if(b=="search"){if(view=="list"){show_grid()}else{$(".line").removeClass("hide");$("#entry").removeClass("hide");$("#entry").html(""+$("#search").html())}}else{if(b.charAt(0)=="/"){b=b.substring(1,b.length)}goto_post(b)}}function init(){$(".post_thumb").click(function(){var a=$(this).attr("id").replace("thumb_","");window.location="#post"+a});$("#search_field").keydown(function(a){if(e_.which==13){$("#search_field").submit()}});$("#loading").fadeTo(n_speed,0);if($.cookie("view")==null){view=default_format;$.cookie("view",view)}else{view=$.cookie("view");default_format=view}if(is_index){if(view=="grid"){$(".grid").removeClass("hide");$("#view_options").html('<li><a href="#list" id="show_list_link" class="rounded">Display as list.</a></li>');$("#show_list_link").click(show_list);getPhotosetImages();getVideoThumbs()}else{$("#entry").addClass("hide");$(".line").addClass("hide");$(".list").removeClass("hide");$("#view_options").html('<li><a href="#grid" class="rounded" id="show_grid_link">Display as grid.</a></li>');$("#show_grid_link").click(show_grid);$(window).scroll(check_for_more)}SWFAddress.addEventListener(SWFAddressEvent.CHANGE,history)}else{}if(!$("body").hasClass("index")&&!$("body").hasClass("perma")){$("#pages").removeClass("hide")}add_credit()}var n_speed=200;var is_index=false;var a_images=[];var n_current_image=0;var view;var previous_page="no";var next_page="no";var is_loading_next=false;var current_page=0;$(document).ready(init);